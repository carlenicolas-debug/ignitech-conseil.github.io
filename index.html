# Retry once on transport error
import base64
from io import BytesIO
from PIL import Image, ImageDraw, ImageFont
from urllib.parse import quote

PRIMARY = (139,0,0)
WHITE = (255,255,255)
BG = (250,250,250)

def draw_flame(draw, cx, cy, scale, outer=PRIMARY):
    outer_pts = [
        (cx, cy-2.8*scale),
        (cx+1.6*scale, cy-1.5*scale),
        (cx+2.2*scale, cy),
        (cx+1.6*scale, cy+1.6*scale),
        (cx, cy+3.0*scale),
        (cx-1.6*scale, cy+1.6*scale),
        (cx-2.2*scale, cy),
        (cx-1.6*scale, cy-1.5*scale),
    ]
    draw.polygon(outer_pts, fill=outer)
    inner_color = tuple(int(0.85*c + 0.15*255) for c in PRIMARY)
    inner_pts = [
        (cx, cy-1.8*scale),
        (cx+1.0*scale, cy-0.8*scale),
        (cx+1.2*scale, cy+0.4*scale),
        (cx, cy+1.8*scale),
        (cx-1.2*scale, cy+0.4*scale),
        (cx-1.0*scale, cy-0.8*scale),
    ]
    draw.polygon(inner_pts, fill=inner_color)

favicon_svg = '''<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#b30000"/><stop offset="100%" stop-color="#8B0000"/></linearGradient></defs>
  <circle cx="32" cy="32" r="30" fill="white"/>
  <path fill="url(#g)" d="M32 10c-3 6 2 9-2 13s-9 6-9 14c0 7 6 13 13 13s13-6 13-13c0-11-8-12-10-21-1 2-2 4-5 6 2-6 1-8 0-12z"/>
  <path fill="#ff5a5a" opacity="0.6" d="M34 20c-1 2 1 3-0 5s-4 2-4 6c0 3 3 6 6 6s6-3 6-6c0-5-4-6-5-10-0 1-1 2-3 3 1-3 1-4 0-6z"/>
</svg>'''
FAVICON_SVG = "data:image/svg+xml;utf8," + quote(favicon_svg)

img32 = Image.new('RGBA', (32,32), (0,0,0,0)); d32 = ImageDraw.Draw(img32); draw_flame(d32, 16, 16, 6)
buf32 = BytesIO(); img32.save(buf32, format='PNG')
FAVICON32 = "data:image/png;base64," + base64.b64encode(buf32.getvalue()).decode()

img180 = Image.new('RGB', (180,180), WHITE); d180 = ImageDraw.Draw(img180)
d180.rounded_rectangle([10,10,170,170], radius=36, fill=(254,254,254), outline=(230,230,230))
draw_flame(d180, 90, 92, 28)
buf180 = BytesIO(); img180.save(buf180, format='PNG')
APPLE_TOUCH = "data:image/png;base64," + base64.b64encode(buf180.getvalue()).decode()

OG_PATH = "/mnt/data/og-image.png"
og = Image.new('RGB', (1200,630), BG); dog = ImageDraw.Draw(og)
dog.rectangle([0,0,360,630], fill=PRIMARY); draw_flame(dog, 180, 315, 90)
try:
    font_title = ImageFont.truetype("DejaVuSans-Bold.ttf", 64)
    font_sub = ImageFont.truetype("DejaVuSans.ttf", 36)
except:
    font_title = ImageFont.load_default(); font_sub = ImageFont.load_default()
dog.text((400,220), "Ignitech Conseil", fill=PRIMARY, font=font_title)
dog.text((400,300), "Prévention incendie ERP — audits & conformité", fill=(60,60,60), font=font_sub)
dog.text((400,360), "Drôme • Ardèche • Isère • Rhône • Vaucluse", fill=(90,90,90), font=font_sub)
og.save(OG_PATH)

template = """<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ignitech Conseil — Prévention incendie ERP (Drôme • Ardèche)</title>
  <meta name="description" content="Ignitech Conseil : audits et conformité sécurité incendie pour ERP. Rapports clairs, références réglementaires, accompagnement commission. Basé à Saint-Péray.">
  <meta name="robots" content="index,follow">
  <link rel="canonical" href="https://ignitech-conseil.fr/">
  <meta property="og:title" content="Ignitech Conseil — Prévention incendie ERP">
  <meta property="og:description" content="Audits & conformité ERP — Drôme, Ardèche, Isère, Rhône, Vaucluse.">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="fr_FR">
  <meta property="og:url" content="https://ignitech-conseil.fr/">
  <meta property="og:image" content="https://ignitech-conseil.fr/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ignitech Conseil — Prévention incendie ERP">
  <meta name="twitter:description" content="Audits & conformité ERP — Drôme, Ardèche, Isère, Rhône, Vaucluse.">
  <meta name="twitter:image" content="https://ignitech-conseil.fr/og-image.png">
  <meta name="theme-color" content="#8B0000">
  <link rel="icon" href="__FAVICON_SVG__" type="image/svg+xml">
  <link rel="icon" href="__FAVICON32__" sizes="32x32">
  <link rel="apple-touch-icon" href="__APPLE__">
  <style>
    :root{--primary:#8B0000;--primary-700:#6f0000;--bg:#ffffff;--bg-alt:#f7f7f7;--text:#1f2937;--muted:#4b5563;--ring:#e5e7eb;--radius:16px;--shadow:0 6px 20px rgba(0,0,0,.08)}
    html{scroll-behavior:smooth} @media (prefers-reduced-motion: reduce){html{scroll-behavior:auto}} *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;line-height:1.6;color:var(--text);background:var(--bg)}
    a{color:var(--primary);text-decoration:none} a:hover{text-decoration:underline}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.95);backdrop-filter:saturate(180%) blur(6px);border-bottom:1px solid var(--ring)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700} .brand .dot{width:14px;height:14px;border-radius:50%;background:var(--primary);display:inline-block}
    nav ul{display:flex;gap:16px;list-style:none;margin:0;padding:0} nav a{padding:8px 10px;border-radius:10px} nav a:hover{background:#f1f1f1;text-decoration:none}
    .hero{background:linear-gradient(180deg,#fff 0,var(--bg-alt) 100%);padding:64px 0 40px} .hero h1{font-size:clamp(28px,4vw,42px);margin:0 0 10px}
    .lead{font-size:clamp(16px,2.2vw,20px);color:var(--muted);max-width:900px}
    .badges{display:flex;flex-wrap:wrap;gap:8px;margin:18px 0} .badge{background:#fff;border:1px solid var(--ring);border-radius:999px;padding:6px 10px;font-size:14px}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px} .btn{display:inline-block;padding:12px 18px;border-radius:12px;font-weight:600;border:1px solid transparent;box-shadow:var(--shadow)}
    .btn-primary{background:var(--primary);color:#fff} .btn-primary:hover{background:var(--primary-700)} .btn-outline{background:#fff;border-color:var(--ring)}
    section{padding:56px 0} h2{font-size:clamp(22px,3vw,30px);margin:0 0 16px} .sub{color:var(--muted);margin-top:-4px;margin-bottom:24px}
    .grid{display:grid;gap:18px} .grid-3{grid-template-columns:repeat(3,1fr)} .grid-2{grid-template-columns:repeat(2,1fr)}
    @media (max-width:900px){.grid-3,.grid-2{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--ring);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)} .card h3{margin:6px 0 8px;font-size:18px}
    .muted{color:var(--muted)} .price{font-size:28px;font-weight:800} .tag{display:inline-block;background:var(--bg);border:1px solid var(--ring);border-radius:999px;padding:4px 8px;font-size:12px;margin-left:8px}
    .steps{counter-reset: step} .step{display:flex;gap:12px;align-items:flex-start} .step .num{flex:0 0 32px;height:32px;border-radius:999px;background:var(--primary);color:#fff;display:grid;place-items:center;font-weight:700}
    footer{background:var(--bg-alt);border-top:1px solid var(--ring);padding:24px 0;color:var(--muted)} .footer-grid{display:grid;gap:18px;grid-template-columns:2fr 1fr}
    @media (max-width:900px){.footer-grid{grid-template-columns:1fr}} .tiny{font-size:13px}
    .notice{background:#fff;border:1px dashed var(--ring);border-radius:12px;padding:12px;color:var(--muted)}
    #contact .field{margin-bottom:12px} #contact label{display:block;font-weight:600;margin-bottom:6px}
    #contact input[type=text], #contact input[type=email], #contact input[type=tel], #contact textarea{width:100%;padding:10px 12px;border:1px solid var(--ring);border-radius:10px;font:inherit;background:#fff}
    #contact input:focus,#contact textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(139,0,0,.10)}
    .cookiebar{position:fixed;left:12px;right:12px;bottom:12px;z-index:9999;background:#ffffff;border:1px solid var(--ring);box-shadow:var(--shadow);border-radius:14px;padding:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .cookiebar p{margin:0;color:var(--muted)} .cookiebar .btn{box-shadow:none}
  </style>
  <script>
    if (location.hostname === 'www.ignitech-conseil.fr') {
      location.replace('https://ignitech-conseil.fr' + location.pathname + location.search + location.hash);
    }
  </script>
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="Navigation principale">
      <div class="brand"><span class="dot" aria-hidden="true"></span>Ignitech Conseil</div>
      <nav><ul>
        <li><a href="#accueil">Accueil</a></li><li><a href="#prestations">Prestations</a></li>
        <li><a href="#tarifs">Tarifs</a></li><li><a href="#references">Références</a></li>
        <li><a href="#contact">Contact</a></li><li><a href="#mentions">Mentions</a></li>
      </ul></nav>
    </div>
  </header>

  <main id="accueil" class="hero">
    <div class="container">
      <h1>Prévention incendie ERP — audits & conformité</h1>
      <p class="lead">Cabinet basé à <strong>Saint-Péray</strong>. Interventions Drôme, Ardèche, Isère, Rhône, Vaucluse. Rapports clairs, <strong>références réglementaires citées</strong>, préparation et accompagnement en commission.</p>
      <div class="badges" aria-label="Atouts">
        <span class="badge">PRV2 – préventionniste</span>
        <span class="badge">23 ans d’expérience</span>
      </div>
      <div class="actions">
        <a class="btn btn-primary" href="mailto:contact@ignitech-conseil.fr?subject=Demande%20d'audit%20ERP%20Ignitech%20Conseil">Demander un audit</a>
        <a class="btn btn-outline" href="tel:+33613620503">Appeler : 06&nbsp;13&nbsp;62&nbsp;05&nbsp;03</a>
      </div>
    </div>
  </main>

  <section id="prestations">
    <div class="container">
      <h2>Prestations principales</h2>
      <p class="sub">Des livrables pensés pour la commission : articles cités, grilles lisibles, priorités A/B/C et photos.</p>
      <div class="grid grid-3">
        <article class="card"><h3>Audit ERP</h3><p class="muted">Visite, relevés, photos, grille de conformité par articles, rapport exploitable par l’exploitant et la commission.</p></article>
        <article class="card"><h3>Suivi post-audit</h3><p class="muted">Plan d’actions priorisé, aide à la mise en conformité, vérifications réglementaires, préparation au passage en commission.</p></article>
        <article class="card"><h3>Accessibilité</h3><p class="muted">Diagnostic pragmatique et recommandations, coordination possible avec la mairie/CCDSA.</p></article>
        <article class="card"><h3>Dossiers & commissions</h3><p class="muted">Notices de sécurité, pièces à fournir, trame de registre, présence le jour J sur demande.</p></article>
        <article class="card"><h3>Formation évacuation (MS 51)</h3><p class="muted">Instruction du personnel, exercice d’évacuation, compte-rendu.</p></article>
        <article class="card"><h3>Événements PA / CTS</h3><p class="muted">Manifs, chapiteaux, marchés, festivals : check-lists opérationnelles et plans appliqués.</p></article>
      </div>
    </div>
  </section>

  <section id="method">
    <div class="container"><h2>Méthode — 5 étapes</h2>
      <div class="grid grid-2 steps">
        <div class="card step"><div class="num">1</div><div><strong>Appel de cadrage</strong><br><span class="muted">15 min, collecte des documents.</span></div></div>
        <div class="card step"><div class="num">2</div><div><strong>Visite & relevés</strong><br><span class="muted">Terrain d’abord, photos et mesures.</span></div></div>
        <div class="card step"><div class="num">3</div><div><strong>Rapport sourcé</strong><br><span class="muted">Articles cités, grilles, photos.</span></div></div>
        <div class="card step"><div class="num">4</div><div><strong>Plan d’actions</strong><br><span class="muted">Priorités A/B/C, faisable et clair.</span></div></div>
        <div class="card step"><div class="num">5</div><div><strong>Commission</strong><br><span class="muted">Préparation & accompagnement.</span></div></div>
      </div>
    </div>
  </section>

  <section id="tarifs" class="pricing" style="background:var(--bg-alt)">
    <div class="container"><h2>Tarifs clairs</h2>
      <p class="sub">Forfaits indicatifs pour établissements standards. Sites complexes : devis sur mesure.</p>
      <div class="grid grid-3">
        <div class="card"><h3>Audit ERP <span class="tag">déplacement 50 km inclus</span></h3><div class="price">1200 € HT</div><p class="muted">Rapport sous 5 jours ouvrés.</p></div>
        <div class="card"><h3>Suivi post-audit</h3><div class="price">800 € HT</div><p class="muted">Mise en conformité guidée.</p></div>
        <div class="card"><h3>Accessibilité</h3><div class="price">500 € HT</div><p class="muted">Diagnostic & recommandations.</p></div>
      </div>
      <div class="notice" style="margin-top:14px">Devis sous 24 h • Entreprises & collectivités • Facturation simple</div>
    </div>
  </section>

  <section id="references">
    <div class="container"><h2>Références (sélection)</h2>
      <p class="sub">Exemples disponibles sur demande (communes, associations, établissements scolaires, commerces).</p>
      <div class="grid grid-3">
        <div class="card"><h3>Collectivités</h3><p class="muted">Accompagnement dossiers & commissions (types L, M, N, R, X, PA).</p></div>
        <div class="card"><h3>Commerces & ERP</h3><p class="muted">Audits réglementaires, plan d’actions priorisé, suivi opérationnel.</p></div>
        <div class="card"><h3>Événementiel</h3><p class="muted">Sécurité chapiteaux, marchés, festivals (PA/CTS).</p></div>
      </div>
    </div>
  </section>

  <section id="zone" style="background:var(--bg-alt)"><div class="container">
    <h2>Zone d’intervention</h2><p class="sub">Basé à Saint-Péray. Drôme, Ardèche, Isère, Rhône, Vaucluse — autres départements sur devis.</p>
  </div></section>

  <section id="contact" style="background:var(--bg-alt)">
    <div class="container"><h2>Contact</h2>
      <div class="grid grid-2">
        <div class="card"><h3>Ignitech Conseil</h3>
          <p class="muted">34 rue de l’Équerre, 07130 Saint-Péray</p>
          <p><strong>Tél.</strong> <a href="tel:+33613620503">06 13 62 05 03</a><br>
             <strong>E-mail</strong> <a href="mailto:contact@ignitech-conseil.fr">contact@ignitech-conseil.fr</a></p>
          <div class="actions"><a class="btn btn-outline" href="tel:+33613620503">Appeler</a>
            <a class="btn btn-primary" href="#contact">Écrire</a></div>
        </div>
        <div class="card"><h3>Écrire un message</h3>
          <form class="form" action="https://formsubmit.co/contact@ignitech-conseil.fr" method="POST">
            <input type="hidden" name="_subject" value="Demande via site — Ignitech Conseil">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_next" value="https://ignitech-conseil.fr/#merci">
            <input type="text" name="_honey" style="display:none">
            <div class="field"><label for="nom">Nom *</label><input id="nom" name="nom" type="text" required></div>
            <div class="field"><label for="email">E-mail *</label><input id="email" name="email" type="email" required></div>
            <div class="field"><label for="tel">Téléphone</label><input id="tel" name="telephone" type="tel" inputmode="tel" pattern="[0-9 +().-]*"></div>
            <div class="field"><label for="msg">Message *</label><textarea id="msg" name="message" rows="6" required></textarea></div>
            <label class="tiny"><input type="checkbox" required> J’accepte l’usage de ces informations pour être recontacté.</label>
            <div class="actions" style="margin-top:10px"><button class="btn btn-primary" type="submit">Envoyer</button></div>
          </form>
        </div>
      </div>
      <div id="merci" class="notice" style="margin-top:14px; display:none">Merci, votre message a bien été envoyé. Nous vous répondons rapidement.</div>
    </div>
    <script>if(location.hash==='#merci'){var el=document.getElementById('merci'); if(el) el.style.display='block';}</script>
  </section>

  <footer id="mentions">
    <div class="container footer-grid">
      <div><strong>Mentions légales</strong>
        <p class="tiny">Ignitech Conseil — Prévention incendie ERP. Siège : 34 rue de l’Équerre, 07130 Saint-Péray. Téléphone : 06 13 62 05 03. E-mail : contact@ignitech-conseil.fr. Forme : micro-entreprise. SIREN : <em>à compléter</em>. Directeur de la publication : N. Carle. Hébergeur : GitHub Pages.</p>
        <p class="tiny">© <span id="year"></span> Ignitech Conseil — Tous droits réservés.</p>
      </div>
      <div><strong>Données & confidentialité</strong>
        <p class="tiny">Ce site ne dépose aucun cookie de suivi. Un stockage local strictement nécessaire peut être utilisé pour masquer ce bandeau.
        Les données envoyées via le formulaire sont utilisées uniquement pour répondre à votre demande. Droits RGPD : <a href="mailto:contact@ignitech-conseil.fr">contact@ignitech-conseil.fr</a>. MAJ : 11/08/2025.</p>
      </div>
    </div>
  </footer>

  <div id="cookiebar" class="cookiebar" role="dialog" aria-live="polite" aria-label="Information cookies" style="display:none">
    <p>Nous n’utilisons pas de cookies de suivi. En poursuivant, vous acceptez le stockage local strictement nécessaire pour masquer ce message. <a href="#mentions">En savoir plus</a>.</p>
    <div class="actions"><button id="cookie-ok" class="btn btn-primary" type="button">OK</button></div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    (function(){try{
      var key='ignitechConsent';
      if(!localStorage.getItem(key)){var el=document.getElementById('cookiebar'); if(el) el.style.display='flex';}
      document.getElementById('cookie-ok').addEventListener('click', function(){
        try{ localStorage.setItem(key,'1'); }catch(e){} var el=document.getElementById('cookiebar'); if(el) el.style.display='none';
      });
    }catch(e){} })();
  </script>
</body>
</html>
"""
html = template.replace("__FAVICON_SVG__", FAVICON_SVG).replace("__FAVICON32__", FAVICON32).replace("__APPLE__", APPLE_TOUCH)

INDEX_PATH = "/mnt/data/index-ignitech-conseil-onefile-ogfile.html"
with open(INDEX_PATH, "w", encoding="utf-8") as f:
    f.write(html)

print(INDEX_PATH)
print(OG_PATH)

